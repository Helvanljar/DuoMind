
{% extends "base.html" %}
{% block title %}Settings â€“ DuoMind{% endblock %}
{% block content %}
<section class="card form">
  <h2>Model & Keys</h2>
  <label>OpenAI Key
    <input id="openai" type="password" placeholder="sk-...">
  </label>
  <label>Gemini Key
    <input id="gemini" type="password" placeholder="AIza...">
  </label>

  <label>Preferred Model
    <select id="preferred_llm">
      <option value="">Choose best available</option>
      <option value="gpt-4o">GPTâ€‘4o (OpenAI)</option>
      <option value="gpt-4o-mini">GPTâ€‘4o-mini</option>
      <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
      <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
      <option value="claude-3.5-sonnet">Claude 3.5 Sonnet</option>
      <option value="claude-3-opus">Claude 3 Opus</option>
      <option value="mistral-large">Mistral Large</option>
      <option value="cohere-command-r-plus">Cohere Commandâ€‘R+</option>
      <option value="groq-mixtral">Groq Mixtral</option>
    </select>
  </label>

  <button class="btn" id="save">Save</button>
  <div id="status" class="status"></div>
  <p class="muted">ðŸ’¡ Recommended: <b>GPTâ€‘4o</b> for quality & reasoning, <b>Gemini 1.5 Flash</b> for speed.</p>
</section>

<script>
  const base = window.location.origin;
  const token = localStorage.getItem("dm_token") || "";
  if (!token) {
    document.getElementById("status").textContent = "You are in guest mode. Please login to save settings.";
  }

  async function api(path, opt={}){
    opt.headers = opt.headers || {};
    if (token) opt.headers.Authorization = "Bearer " + token;
    const res = await fetch(base+path, opt);
    if(!res.ok) throw new Error(await res.text());
    return await res.json();
  }

  (async () => {
    if (!token) return;
    try {
      const s = await api("/api/settings");
      if (s.preferred_llm) document.getElementById("preferred_llm").value = s.preferred_llm;
    } catch(e){ console.error(e); }
  })();

  document.getElementById("save").onclick = async () => {
    const openai = document.getElementById("openai").value;
    const gemini = document.getElementById("gemini").value;
    const preferred_llm = document.getElementById("preferred_llm").value;
    try {
      await api("/api/settings", {method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({openai_key:openai, gemini_key:gemini, preferred_llm})});
      document.getElementById("status").textContent = "âœ… Saved";
    } catch(e){ document.getElementById("status").textContent = e; }
  };
</script>
{% endblock %}
