{% extends "base.html" %}
{% block title %}DuoMind ‚Äì Login{% endblock %}

{% block content %}
<section class="auth-page">
  <div class="auth-card card">
    <h1 class="auth-title" data-i18n-auto>Anmelden</h1>
    <p class="muted" data-i18n-auto>
      Melde dich an, um deine Schl√ºssel zu verwalten und loszulegen.
    </p>

    {# ‚úÖ Read error from query params (redirect-safe) #}
    {% set err = request.query_params.get("error", "") %}
    {% if err %}
      <div class="auth-alert show" role="alert" aria-live="polite">
        {% if err == "invalid_credentials" %}
          <span data-i18n-auto>Falsche E-Mail oder Passwort.</span>
        {% else %}
          <span data-i18n-auto>Etwas ist schiefgelaufen. Bitte versuch es erneut.</span>
        {% endif %}
      </div>
    {% endif %}

    <form method="post" action="/auth/login" class="auth-form">
      <label class="auth-label" for="email" data-i18n-auto>E-Mail</label>
      <input
        id="email"
        name="email"
        class="auth-input"
        type="email"
        autocomplete="email"
        placeholder="E-Mail"
        required
        value="{{ request.query_params.get('email','') }}"
      />

      <label class="auth-label" for="password" data-i18n-auto>Passwort</label>
      <div class="auth-password">
        <input
          id="password"
          name="password"
          class="auth-input"
          type="password"
          autocomplete="current-password"
          placeholder="Passwort"
          required
        />
        <button
          type="button"
          class="eye-btn"
          aria-label="Toggle password"
          onclick="togglePw('password')"
        >
          üëÅ
        </button>
      </div>

      <button type="submit" class="btn-primary auth-submit" data-i18n-auto>
        Anmelden
      </button>

      <p class="auth-switch">
        <span class="muted" data-i18n-auto>Noch kein Konto?</span>
        <a
          href="/auth/register-page"
          class="auth-link auth-link--premium"
          data-i18n-auto
        >
          Registrieren
        </a>
      </p>
    </form>
  </div>
</section>

<script>
  function togglePw(id){
    const el = document.getElementById(id);
    if (!el) return;
    el.type = (el.type === "password") ? "text" : "password";
  }
</script>
{% endblock %}
